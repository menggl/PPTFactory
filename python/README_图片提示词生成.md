# 图片提示词生成工具使用说明

## 功能说明

根据 `ppt内容映射.txt` 文件中的 `图片提示词准备` 内容，结合 `大纲目录.txt` 和 `requirement.txt` 的内容，生成适合PPT演示的图片提示词。

## 使用方法

### 方式1: 手动生成（不使用API，基于规则）

```bash
cd /Users/menggl/workspace/PPTFactory
python3 python/generate_image_prompts.py
```

这种方式会根据图片提示词准备内容，使用规则自动生成图片提示词。

### 方式2: 使用OpenAI API生成（推荐）

```bash
# 设置API密钥
export OPENAI_API_KEY="your-api-key-here"

# 运行脚本
cd /Users/menggl/workspace/PPTFactory
python3 python/generate_image_prompts.py --use-api
```

或者直接在命令行指定API密钥：

```bash
python3 python/generate_image_prompts.py --use-api --api-key "your-api-key-here"
```

### 使用其他模型

```bash
# 使用gpt-3.5-turbo（更便宜）
python3 python/generate_image_prompts.py --use-api --model "gpt-3.5-turbo"

# 使用gpt-4（更高质量）
python3 python/generate_image_prompts.py --use-api --model "gpt-4"
```

## 功能特点

1. **自动读取映射文件**: 从 `produce/ppt内容映射.txt` 读取 `图片提示词准备`
2. **结合上下文**: 结合 `大纲目录.txt` 和 `requirement.txt` 的内容生成更准确的提示词
3. **PPT风格优化**: 生成的图片提示词专门针对PPT演示风格进行优化
4. **尺寸信息保留**: 自动保留图片提示词准备中的尺寸信息
5. **更新映射文件**: 在 `ppt内容映射.txt` 中添加 `图片提示词` 字段

## 输入文件

- **ppt内容映射.txt**: 必须包含 `图片提示词准备` 字段
- **大纲目录.txt**: 提供PPT的整体结构信息
- **requirement.txt**: 提供需求文档内容

## 输出结果

在 `ppt内容映射.txt` 文件中，每个页面会添加 `图片提示词` 字段：

```json
{
  "模板页编号": "T002",
  "文本映射": { ... },
  "图片提示词准备": {
    "三我是文本|四我是长文本|极简线条": "作业前检查与规范启动|严格执行《煤矿安全规程》...|极简线条|图片尺寸为像素696宽 × 576像素高"
  },
  "图片提示词": {
    "三我是文本|四我是长文本|极简线条": "极简线条风格，主题：作业前检查与规范启动，严格执行《煤矿安全规程》...，PPT演示风格，专业商务插图，清晰简洁，适合教育展示，尺寸：图片尺寸为像素696宽 × 576像素高"
  }
}
```

## 生成规则

### 手动生成模式

1. 解析图片提示词准备，提取替换文本、其他信息和图片大小
2. 根据其他信息（如"极简线条"、"圆形图片"）添加风格关键词
3. 使用替换文本作为主题内容
4. 添加PPT演示风格要求
5. 保留图片尺寸信息

### API生成模式

使用OpenAI API生成更专业、更详细的图片提示词，会考虑：
- 大纲目录的整体结构
- 需求文档的具体要求
- 图片提示词准备的详细内容
- PPT演示的最佳实践

## 注意事项

1. **API使用**: 使用OpenAI API需要安装 `openai` 库：
   ```bash
   pip install openai
   ```

2. **API密钥**: 确保设置了正确的API密钥，否则会回退到手动生成模式

3. **已存在提示词**: 如果某个图片提示词准备已经存在提示词，会跳过不重新生成

4. **图片尺寸**: 生成的图片提示词会保留图片提示词准备中的尺寸信息，确保生成的图片符合要求

5. **成本考虑**: 使用API生成会产生费用，建议先用手动模式测试，确认流程正确后再使用API

## 示例

### 输入（图片提示词准备）

```
三我是文本|四我是长文本|极简线条 => 作业前检查与规范启动|严格执行《煤矿安全规程》和采煤机操作规范，包括检查截齿、隔离开关、电缆、喷雾、瓦斯浓度等关键部件，确认合格再作业，减少设备和人员风险。开机前必须完成设备检查和环境检查，确保设备状态良好。|极简线条|图片尺寸为像素696宽 × 576像素高
```

### 输出（图片提示词）

**手动生成模式**:
```
极简线条风格，主题：作业前检查与规范启动，严格执行《煤矿安全规程》和采煤机操作规范，包括检查截齿、隔离开关、电缆、喷雾、瓦斯浓度等关键部件，确认合格再作业，减少设备和人员风险。开机前必须完成设备检查和环境检查，确保设备状态良好。，PPT演示风格，专业商务插图，清晰简洁，适合教育展示，尺寸：图片尺寸为像素696宽 × 576像素高
```

**API生成模式**:
```
极简线条风格的PPT演示插图，主题为煤矿安全操作规范。画面展示采煤机司机在作业前进行设备检查的场景，包括检查截齿、隔离开关、电缆、喷雾装置和瓦斯浓度等关键部件。采用简洁的线条设计，专业商务风格，适合教育展示。图片尺寸为696像素宽 × 576像素高，确保在PPT中清晰展示。
```

## 故障排除

1. **找不到图片提示词准备**: 确保先运行了生成图片提示词准备的步骤
2. **API调用失败**: 检查API密钥是否正确，网络是否正常
3. **文件读取错误**: 确保所有输入文件都存在且格式正确
